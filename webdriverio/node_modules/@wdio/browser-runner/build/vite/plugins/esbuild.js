import fs from 'node:fs/promises';
export function codeFrameFix() {
    return {
        name: 'wdio:codeFrameFix',
        setup(build) {
            build.onLoad({ filter: /@babel\/code-frame/, namespace: 'file' }, 
            /**
             * mock @babel/code-frame as it fails in Safari due
             * to usage of chalk
             */
            async ({ path: id }) => {
                const code = await fs.readFile(id).then((buf) => buf.toString(), () => undefined);
                if (!code) {
                    return;
                }
                return {
                    contents: code.replace('require("@babel/highlight");', /*js*/ `{
                            shouldHighlight: false,
                            reset: () => {}
                        }`)
                };
            });
        }
    };
}
